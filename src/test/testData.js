export const venues = [
  "E006",
  "E005",
  "E106",
  "E105",
  "D005",
  "D006",
  "D105",
  "D106",
  "Physics Lab",
  "Software Lab",
  "C307",
];

export const courses = [
  {
    courseName: "Introduction to Computer Science",
    courseUnits: 2,
    lecturerName: "Dr. Smith",
    department: ["Computer Science"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Calculus I",
    courseUnits: 3,
    lecturerName: "Prof. Johnson",
    department: ["Mathematics"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "English Composition",
    courseUnits: 2,
    lecturerName: "Dr. Anderson",
    department: [
      "Computer Science",
      "Mathematics",
      "Art History",
      "Physics",
      "Psychology",
      "Chemistry",
      "English",
    ],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "History of Art",
    courseUnits: 1,
    lecturerName: "Prof. Davis",
    department: ["Art History"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Physics I",
    courseUnits: 3,
    lecturerName: "Dr. White",
    department: ["Physics"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Psychology 101",
    courseUnits: 2,
    lecturerName: "Prof. Lee",
    department: ["Psychology"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Introduction to Chemistry",
    courseUnits: 1,
    lecturerName: "Dr. Baker",
    department: ["Chemistry"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Web Development Fundamentals",
    courseUnits: 3,
    lecturerName: "Dr. Johnson",
    department: ["Computer Science"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "World History",
    courseUnits: 2,
    lecturerName: "Prof. Miller",
    department: ["History"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Digital Marketing",
    courseUnits: 3,
    lecturerName: "Dr. Brown",
    department: ["Marketing"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Introduction to Literature",
    courseUnits: 1,
    lecturerName: "Prof. Wilson",
    department: ["English"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Organic Chemistry",
    courseUnits: 3,
    lecturerName: "Dr. Davis",
    department: ["Chemistry"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Linear Algebra",
    courseUnits: 3,
    lecturerName: "Prof. Adams",
    department: ["Mathematics"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Introduction to Psychology",
    courseUnits: 2,
    lecturerName: "Dr. Evans",
    department: ["Psychology"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Data Structures and Algorithms",
    courseUnits: 3,
    lecturerName: "Dr. Taylor",
    department: ["Computer Science"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Sociology of Culture",
    courseUnits: 2,
    lecturerName: "Prof. Walker",
    department: ["Sociology"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Art History: Ancient to Renaissance",
    courseUnits: 1,
    lecturerName: "Dr. Clark",
    department: ["Art History"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Environmental Science",
    courseUnits: 2,
    lecturerName: "Prof. Lewis",
    department: ["Environmental Science"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Economics Principles",
    courseUnits: 3,
    lecturerName: "Dr. Hall",
    department: ["Economics"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Spanish Language Basics",
    courseUnits: 1,
    lecturerName: "Prof. Martinez",
    department: ["Foreign Language"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Organizational Behavior",
    courseUnits: 3,
    lecturerName: "Dr. King",
    department: ["Management"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Political Science 101",
    courseUnits: 2,
    lecturerName: "Prof. Wright",
    department: ["Political Science"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Digital Design Fundamentals",
    courseUnits: 3,
    lecturerName: "Dr. Smith",
    department: ["Computer Science"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Anthropology: Cultural Perspectives",
    courseUnits: 2,
    lecturerName: "Prof. Johnson",
    department: ["Anthropology"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Statistics for Social Sciences",
    courseUnits: 3,
    lecturerName: "Dr. Brown",
    department: [
      "Statistics",
      "Mathematics",
      "Computer Science",
      "Political Science",
    ],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Introduction to Engineering",
    courseUnits: 2,
    lecturerName: "Prof. Davis",
    department: ["Engineering"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "French Language Basics",
    courseUnits: 1,
    lecturerName: "Prof. Adams",
    department: ["Foreign Language"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Marketing Strategy",
    courseUnits: 3,
    lecturerName: "Dr. White",
    department: ["Marketing"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
  {
    courseName: "Philosophy: Ethics and Morality",
    courseUnits: 2,
    lecturerName: "Prof. Lee",
    department: ["Philosophy"],
    level: Math.floor(Math.random() * 4 + 1) * 100,
  },
];

export const times = [8, 9, 10, 11, 12, 13, 14, 15, 16, 17];
export const days = ["monday", "tuesday", "wednesday", "thursday", "friday"];

const createTimeTable = (courses, venues) => {
  const timetable = {
    monday: [],
    tuesday: [],
    wednesday: [],
    thursday: [],
    friday: [],
  };

  let coursesCopy = courses.map((el) => {
    return {
      ...el,
      remainingHours: el.courseUnits,
    };
  });

  days.forEach((day) => {
    times.forEach((time) => {
      let classes = [];

      if (time === 13) {
        classes = [...classes, "lunch"];
        timetable[day] = [...timetable[day], classes];
        return;
      }

      coursesCopy.forEach((course, i) => {
        if (i >= venues.length) return;

        const {
          courseName,
          courseUnits,
          lecturerName,
          department,
          level,
          remainingHours,
          pushed = false,
          hadOn = "",
        } = course;

        const doesClassesHaveCourseName = classes.find(
          (el) => el.courseName === courseName
        );
        const doesClassesHaveLecturerHavingAClass = classes.find(
          (el) => el.lecturerName === lecturerName
        );

        const doesClassesHaveALevelInADepartmentHavingAClass = classes.find(
          (el) => el.level === level && el.department.includes(...department)
        );

        if (doesClassesHaveCourseName) return;

        if (doesClassesHaveLecturerHavingAClass) return;

        if (doesClassesHaveALevelInADepartmentHavingAClass) return;

        // To ensure courses dont extend for 3 hours straight
        if (courseUnits === 3 && remainingHours === 1 && !pushed) {
          coursesCopy = coursesCopy.filter(
            (el) => courseName !== el.courseName
          );
          coursesCopy = [
            ...coursesCopy,
            { ...course, pushed: true, hadOn: day },
          ];
          return;
        }

        // Ensures 3 units courses doesnt occur on the same day
        if (remainingHours === 1 && pushed && hadOn === day) return;

        if (time === 12 && remainingHours === 2 && courseUnits === 2) return;
        if (time === 12 && remainingHours === 3 && courseUnits === 3) return;

        classes = [...classes, { ...course, venue: venues[i], time }];

        coursesCopy = coursesCopy.map((course) => {
          if (course.courseName === courseName && course.level === level) {
            return {
              ...course,
              remainingHours: remainingHours - 1,
            };
          } else return course;
        });
      });

      coursesCopy = coursesCopy.filter((course) => course.remainingHours !== 0);
      timetable[day] = [...timetable[day], classes];
    });
  });

  // const ogCourses = courses.map((el) => `${el.courseName} ${el.level}`);
  // const ogCousesSet = new Set([...ogCourses]);
  // console.log(ogCousesSet);

  // const allCourses = Object.values(timetable)
  //   .flat()
  //   .flat()
  //   .flatMap((el) => `${el.courseName} ${el.level}`);
  // const setCo = new Set([...allCourses]);
  return timetable;
};

const transformTimeTable = (timetable, times, venues) => {
  let transformedTimeTable = [];
  console.log(timetable);

  days.forEach((day) => {
    for (let i = 0; i < venues.length; i++) {
      let data = { day };
      for (let j = 0; j < times.length; j++) {
        const course = timetable[day][j][i];
        if (j + 8 === 13) {
          data[j + 8] = "Lunch";
          continue;
        }

        if (!course) {
          data[j + 8] = "";
          continue;
        }

        data[course.time] = `${course.courseName} ${course.courseUnits}`;
      }
      transformedTimeTable = [...transformedTimeTable, data];
    }
  });
  return transformedTimeTable;
};

const spanTimeTableRows = (timetable) => {
  let timetableCopy = [...timetable];

  days.forEach((day) => {
    const numberOfRowsInDay = timetable.filter((el) => el.day === day).length;
    const indexOfFirstRowInDay = timetable.findIndex((el) => el.day === day);

    timetableCopy = timetableCopy.map((el, i) => {
      if (i === indexOfFirstRowInDay) {
        return { ...el, rowspan: numberOfRowsInDay };
      } else {
        return el;
      }
    });
  });

  return timetableCopy;
};

export { createTimeTable, transformTimeTable, spanTimeTableRows };
